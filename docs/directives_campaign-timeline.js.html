<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: directives/campaign-timeline.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: directives/campaign-timeline.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function () {
  'use strict';

  appCivistApp
    .directive('campaignTimeline', CampaignTimeline);

  CampaignTimeline.$inject = ['Campaigns', 'localStorageService'];

  function CampaignTimeline(Campaigns, localStorageService) {

    function loadCampaignComponents(scope, aid, cid) {
      scope.user = localStorageService.get('user');
      var res;
      if (scope.user) {
        res = Campaigns.components(aid, cid,false,null,null);
      } else {
        res = Campaigns.components(null, null,true,cid,null);
      }
      res.then(function (data) {
        var currentComponent = Campaigns.getCurrentComponent(data);
        angular.forEach(data, function (c) {
          c.cssClass = getComponentCssClass(scope, currentComponent, c);
        });
        scope.components = data;
      });
    }

    /**
     * Set timeline stage status.
     *
     * @param currentComponent {Component} the current component.
     * @param c {Component} the timeline component.
     **/
    function getComponentCssClass(scope, currentComponent, c) {
      var idField = scope.user ? 'componentId' : 'uuid';

      if (c[idField] === currentComponent[idField]) {
        return 'active';
      }

      if (c.position &lt; currentComponent.position) {
        return 'inactive';
      }
      return 'future';
    }

    return {
      restrict: 'E',
      scope: {
        assemblyId: '=',
        campaignId: '=',
        title: '@',
        onlyLabel: '='
      },
      templateUrl: '/app/v2/partials/directives/campaign-timeline.html',
      link: function postLink(scope, element, attrs) {

        if (!scope.campaignId) {
          scope.$watch('campaignId', function (cid) {
            loadCampaignComponents(scope, scope.assemblyId, cid);
          });
        } else {
          loadCampaignComponents(scope, scope.assemblyId, scope.campaignId);
        }

        scope.formatDate = function (date) {
          return moment(date, 'YYYY-MM-DD HH:mm').local().format('L');
        };

        scope.toggleMilestoneDescription = function (milestone, milestones) {
          angular.forEach(milestones, function (m) {
            if (milestone.componentMilestoneId !== m.componentMilestoneId) {
              m.showDescription = false;
            }
          });
          milestone.showDescription = !milestone.showDescription;
        };

        scope.clearMilestonesMenu = function (components) {
          angular.forEach(components, function (c) {
            c.isHover = false;
          });
        };

        scope.toggleComponent = function (component, components) {
          var isHover = component.isHover;
          this.clearMilestonesMenu(components);
          component.isHover = !isHover;
        };
      }
    };
  }
} ());
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Feb 23 2017 09:57:14 GMT-0300 (PYST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
