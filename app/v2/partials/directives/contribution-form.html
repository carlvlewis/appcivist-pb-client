<form name="contributionForm">
  <!-- IDEAS FORM  -->
  <div class="modal_content__add_proposal" ng-if="vm.isIdea && !vm.importOnlyForm">
    <header class="modal-header" ng-style="vm.coverPhotoStyle">
      <div class="file-field">
        <div class="add-button">
          <button class="btn add-button-item" type="button" ngf-select="vm.uploadFile($file, 'cover')" accept="*/*" ngf-max-size="{{vm.coverPhotoSize}}MB">
            {{ 'Edit Cover Photo' |  translate}}
          </button>
          <div class="image-capsule add-button-item" ng-if="vm.fileLoaded">
            <img alt="{{vm.contribution.cover.name}}" ng-src="{{vm.contribution.cover.url}}" class="image-circle image-circle-selected">
          </div>
        </div>
      </div>

      <div class="field__container" ng-if="!vm.hiddenFieldsMap['title']">
        <input ng-model="vm.contribution.title" class="title" ng-required="true" ng-disabled="vm.disabled" id="add_proposal__title"
          type="text" placeholder="{{ 'Title of Idea' | translate }}..." name="title" ng-maxlength="50">
        <div ng-messages="contributionForm.title.$error" style="color:maroon" role="alert">
          <div ng-message="required">{{'This field is required' | translate}}</div>
          <div ng-message="maxlength">{{'Value is too long' | translate}}, 50 {{'characters allowed' | translate}}</div>
        </div>
      </div>
    </header>
    <div class="modal-body">
      <fieldset>
        <!-- Description -->
        <div class="field__container" ng-if="!vm.hiddenFieldsMap['description']">
          <p for="add_proposal__description" class="bold">{{'What is your Idea?' | translate}} <abbr title="Required">*</abbr></p>
          <label>{{'Where will this occur? Who will benefit? Why is this needed?' | translate}}</label>
          <textarea ui-tinymce="vm.tinymceOptions" ng-model="vm.contribution.text" ng-required="true" ng-disabled="disabled" id="add_proposal__description"
            name="text" rows="8" cols="48" placeholder="{{'Description' | translate}}"></textarea>
          <div ng-messages="contributionForm.text.$error" style="color:maroon" role="alert">
            <div ng-message="required">{{'This field is required' | translate}}</div>
          </div>
          <div style="color:maroon" role="alert">
            <div ng-show="contribution.text.length > 200">{{'Value is too long' | translate}}, 200 {{'characters allowed' | translate}}</div>
          </div>
        </div>


        <!-- Themes -->
        <div class="field__container assign_proposal_to_users" ng-if="vm.isCreate && !vm.hiddenFieldsMap['officialThemes']">
          <fieldset class="add_proposal__availble_themes">
            <p class="intro bold">{{'Idea Themes' | translate}} *</p>
            <label class="add_proposal__categories_label">{{'idea.form.themes.description' | translate : vm.campaign}}</label>
            <tags-field load-items="vm.loadOfficialThemes(query)" options="vm.themesOptions" selected="vm.contribution.officialThemes"
              prefetch="true" disabled="vm.disabled"></tags-field>
          </fieldset>
        </div>

        <!-- Keywords -->
        <div class="field__container assign_proposal_to_users" ng-if="vm.isCreate && !vm.hiddenFieldsMap['emergentThemes']">
          <fieldset class="add_proposal__availble_themes">
            <p class="intro bold">
              {{'Idea Keywords' | translate}}
              <i class="fa fa-question-circle" tooltip-placement="right" uib-tooltip="{{'help.tooltip.idea.form.keywords' | translate}}"
                data-toggle="tooltip" data-placement="right" title=""></i>
            </p>
            <label class="add_proposal__categories_label">{{'idea.form.keywords' | translate}}</label>
            <tags-field load-items="vm.loadEmergentThemes(query)" options="vm.themesOptions" selected="vm.contribution.emergentThemes"
              prefetch="true" disabled="vm.disabled" can-add="true"></tags-field>
          </fieldset>
        </div>

        <div class="field__container" ng-if="(vm.campaignFields && vm.campaignFields.length) || (vm.componentFields && vm.componentFields.length)">
          <fieldset>
            <p class="intro">{{'Custom information' | translate}}</p>
            <custom-field ng-repeat="field in vm.campaignFields | orderBy:'position'" definition="field" value="vm.values[field.customFieldDefinitionId]"></custom-field>
            <custom-field ng-repeat="field in vm.componentFields | orderBy:'position'" definition="field" value="vm.values[field.customFieldDefinitionId]"></custom-field>
          </fieldset>
        </div>

        <!-- Non Member Author -->
        <p class="intro bold">{{'Idea Author(s) Information' | translate}}</p>
        <span>
          {{'idea.form.author.disclaimer' | translate : vm.campaign}}
        </span>
        <div class="field__container assign_proposal_to_users nonmember_author" ng-if="vm.isCreate && !vm.hiddenFieldsMap['non-member-authors']">
          <fieldset class="user__assignment">
            <uib-accordion close-others="true">
              <div uib-accordion-group ng-repeat="author in vm.contribution.nonMemberAuthors" is-open="author.isOpen">
                <uib-accordion-heading>
                  <i class="pull-right fa fa-trash" ng-click="$event.stopPropagation();$event.preventDefault();vm.deleteAuthor(author)"></i>
                  <h5 ng-if="!author.name">{{'Author Information' | translate}}</h5>
                  <h5 ng-if="author.name">{{author.name}}</h5>
                </uib-accordion-heading>
                <nonmember-author-form id="non-member-authors" author="author" ng-disabled="vm.disabled" form="contributionForm"></nonmember-author-form>
              </div>
            </uib-accordion>
          </fieldset>

          <button type="button" class="btn btn-default" ng-click="vm.addNewAuthor(false, $event)">{{'Add another author' | translate}}</button>
        </div>

        <div ng-if="vm.isAnonymous" class="col-*-12" vc-recaptcha ng-model="vm.recaptchaResponse" on-success="vm.setCaptchaResponse(response)"
          style="margin-bottom: 10px;"></div>

        <fieldset>
          <a class="button__modal_submit" ng-click="vm.submit()" ng-disabled="!vm.recaptchaResponseOK">{{'Save and submit' | translate}}</a>
        </fieldset>
      </fieldset>
    </div>
  </div>


  <!-- PROPOSALS/IDEAS IMPORT ONLY FORM -->
  <div class="modal_content__add_proposal" ng-if="vm.importOnlyForm">
    <header class="modal-header">
      <h2 class="modal__title" ng-if="vm.isIdea">{{'Import ideas' | translate}}</h2>
      <h2 class="modal__title" ng-if="vm.isProposal">{{'Import proposals' | translate}}</h2>
    </header>
    <div class="modal-body">
      <fieldset ng-if="vm.userIsAssemblyCoordinator && vm.isCreate">
        <h4>{{'Upload csv file' | translate}}</h4>
        <label for="upload">{{'import.ideas.csv-description'|translate}}</label>
        <code>
        <span translate='import.column.code' uib-tooltip="{{'import.column.description.code'|translate}}" tooltip-placement="bottom"></span>,
        <span translate='import.column.source' uib-tooltip="{{'import.column.description.source'|translate}}"></span>,
        <span translate='import.column.title' uib-tooltip="{{'import.column.description.title'|translate}}"></span>,
        <span translate='import.column.description' uib-tooltip="{{'import.column.description.description'|translate}}"></span>,
        <span translate='import.column.category' uib-tooltip="{{'import.column.description.category'|translate}}"></span>,
        <span translate='import.column.keywords' uib-tooltip="{{'import.column.description.keywords'|translate}}"></span>,
        <span translate='import.column.date' uib-tooltip="{{'import.column.description.date'|translate}}"></span>,
        <span translate='import.column.location' uib-tooltip="{{'import.column.description.location'|translate}}"></span>,
        <span translate='import.column.group' uib-tooltip="{{'import.column.description.group'|translate}}"></span>,
        <span translate='import.column.author-name' uib-tooltip="{{'import.column.description.author-name'|translate}}"></span>,
        <span translate='import.column.author-phone' uib-tooltip="{{'import.column.description.author-phone'|translate}}"></span>,
        <span translate='import.column.author-email' uib-tooltip="{{'import.column.description.author-email'|translate}}"></span>
        </code>
        <input type="file" name="upload" fileread on-file-read="vm.setFile($file)">
       <label><input type="checkbox" name="createThemes" ng-model="vm.importCreateThemes">{{'Create Themes themes if they do not exist'|translate}}</label>
        <a class="button__modal_submit" ng-click="vm.submit()">{{'Upload' | translate}}</a>
      </fieldset>
    </div>
  </div>
</form>
