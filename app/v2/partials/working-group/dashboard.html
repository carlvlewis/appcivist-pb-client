<main class="appmain" ng-class="{anonymous: isAnonymous}" resize>
  <article class="working_group">
    <!-- Working Group Header -->
    <header class="page__header">
      <div class="row">
        <breadcrumb label="wg.name"></breadcrumb>
      </div>
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="hidden-xs type">
            <i class="fa" ng-class="{'fa-users' : !isTopicGroup, 'fa-tags': isTopicGroup}"></i> &nbsp;&nbsp;{{isTopicGroup
            ? 'Topic' : 'Working Group' | translate}}
            <span class="label label-success" ng-if="((wg && isTopicGroup)
                || (wg && wg.profile && wg.profile.supportedMembership === 'OPEN'))">{{'Open' | translate}}</span>
          </div>
          <div class="hidden-lg hidden-md hidden-sm type">
            <i class="fa" ng-class="{'fa-users' : !isTopicGroup, 'fa-tags': isTopicGroup}"></i> &nbsp;&nbsp;{{isTopicGroup
            ? 'Topic' : 'Working Group' | translate}}
            <span class="label label-success" ng-if="((wg && isTopicGroup)
                || (wg && wg.profile && wg.profile.supportedMembership === 'OPEN'))">{{'Open' | translate}}</span>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-10">
          <div class="title_block">
            <h1 class="heading--title"> {{wg.name}}</h1>
            <div class="heading_actions" ng-if="!isAnonymous">
              <ul>
                <li class="action__contextual_menu" ng-mouseenter="cm.isHover = true">
                  <a>
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                      y="0px" width="15.998px" height="16px" viewBox="0 0 16 16" xml:space="preserve">
                       <path class="icon" d="M15.998,6.863v2.312c0,0.084-0.027,0.162-0.083,0.239s-0.125,0.122-0.209,0.136L13.78,9.843
                         c-0.132,0.375-0.267,0.69-0.406,0.948c0.243,0.346,0.615,0.825,1.114,1.437c0.069,0.083,0.104,0.171,0.104,0.262
                         c0,0.089-0.031,0.169-0.094,0.239c-0.188,0.256-0.531,0.631-1.031,1.123c-0.5,0.493-0.826,0.739-0.979,0.739
                         c-0.084,0-0.174-0.03-0.271-0.094l-1.438-1.124c-0.306,0.159-0.621,0.291-0.947,0.396c-0.111,0.944-0.213,1.59-0.303,1.937
                         c-0.048,0.195-0.173,0.293-0.375,0.293H6.843c-0.097,0-0.182-0.029-0.255-0.089c-0.074-0.059-0.113-0.134-0.12-0.225l-0.292-1.916
                         c-0.34-0.111-0.653-0.24-0.938-0.386l-1.468,1.114c-0.07,0.063-0.156,0.094-0.261,0.094c-0.097,0-0.184-0.037-0.26-0.114
                         c-0.875-0.791-1.447-1.374-1.719-1.748c-0.048-0.07-0.073-0.15-0.073-0.239c0-0.084,0.028-0.165,0.084-0.24
                         c0.104-0.146,0.281-0.376,0.531-0.692c0.25-0.317,0.438-0.562,0.562-0.734c-0.188-0.348-0.33-0.691-0.427-1.032L0.302,9.51
                         C0.211,9.496,0.139,9.451,0.083,9.379C0.027,9.306,0,9.226,0,9.135V6.822c0-0.083,0.027-0.164,0.083-0.239
                         c0.056-0.077,0.122-0.122,0.199-0.137l1.937-0.291c0.097-0.32,0.232-0.638,0.406-0.958C2.347,4.802,1.976,4.323,1.51,3.759
                         C1.441,3.676,1.406,3.593,1.406,3.51c0-0.07,0.032-0.149,0.094-0.24c0.181-0.25,0.523-0.623,1.025-1.119
                         C3.029,1.654,3.357,1.405,3.51,1.405c0.09,0,0.18,0.036,0.271,0.104l1.438,1.116C5.524,2.464,5.84,2.332,6.167,2.228
                         c0.11-0.943,0.211-1.589,0.302-1.937C6.517,0.098,6.642,0,6.843,0h2.312C9.252,0,9.337,0.029,9.41,0.089
                         c0.073,0.058,0.113,0.134,0.12,0.223l0.291,1.916c0.341,0.111,0.653,0.24,0.938,0.387l1.479-1.116
                         c0.062-0.062,0.146-0.094,0.25-0.094c0.09,0,0.177,0.036,0.26,0.104c0.896,0.827,1.469,1.417,1.719,1.771
                         c0.048,0.057,0.073,0.132,0.073,0.229c0,0.083-0.028,0.163-0.084,0.239c-0.104,0.146-0.28,0.376-0.53,0.693
                         c-0.251,0.315-0.438,0.56-0.563,0.734c0.181,0.347,0.323,0.688,0.427,1.02l1.906,0.292c0.09,0.014,0.163,0.057,0.219,0.13
                         C15.971,6.69,15.998,6.773,15.998,6.863z M9.884,9.884c0.521-0.52,0.781-1.149,0.781-1.886c0-0.736-0.26-1.364-0.781-1.884
                         c-0.52-0.522-1.149-0.782-1.885-0.782c-0.735,0-1.364,0.26-1.885,0.782C5.593,6.634,5.333,7.262,5.333,7.998
                         c0,0.736,0.26,1.366,0.781,1.886c0.521,0.521,1.149,0.78,1.885,0.78C8.735,10.664,9.364,10.404,9.884,9.884z"></path>
                     </svg>
                  </a>
                </li>
              </ul>
              <div class="contextual_menu" ng-class="{active: cm.isHover}" ng-mouseleave="cm.isHover = false" style="top: 1em; left: auto; right: 0px;"
                ng-if="cm.isHover">
                <div class="content">
                  <wgroup-contextual-items wgroup="wg"></wgroup-contextual-items>
                </div>
              </div>
            </div>
          </div>
          <p class="description">{{wg.text}}</p>
        </div>
        <div class="hidden-xs col-lg-2 col-md-2 col-sm-2">
          <img src="{{wg.profile.icon}}" height="140" width="140" style="border-radius:50%;">
        </div>
      </div>
    </header>

    <!-- Working Group Activity and Resources -->
    <div class="page__contents" ng-if=" wg && !isTopicGroup && !isAnonymous">
      <section class="panel activity-and-members">
        <section class="latest-activity">
          <div class="panel-heading panel-heading-relative">
            <h1 class="heading--header">{{'Latest Activity' | translate}}</h1>
            <p class="heading--small">
              <!-- TODO: implements this view -->
              <a ng-if="false" href="&#x2F;patterns&#x2F;03-templates-07-all-proposals-view&#x2F;03-templates-07-all-proposals-view.html"><i class="fa fa-arrows-alt"></i>&nbsp;{{'See All' | translate}}</a>&nbsp;&nbsp;
            </p>
          </div>
          <activity-card ng-repeat="activity in activities | limitTo:activitiesLimit track by $index " activity="activity"></activity-card>
          <p ng-if="!activities || activities.length === 0" class="card">{{'no.latest.activity' | translate}}</p>
        </section>
        <section class="members-panel" ng-if="wg.supportedMembership!='OPEN'">
          <div class="panel-heading panel-heading-relative">
            <h1 class="heading--header">{{'Members' | translate}}</h1>
            <p class="heading--small">
              <a href="" ng-click="toggleAllMembers()"><i class="fa fa-arrows-alt"></i>&nbsp;{{'See All' | translate}}</a>&nbsp;&nbsp;
              <!--<a class="proposals__add_new" ng-if="!isAnonymous && newProposalsEnabled" ng-click="openModal('proposalFormModal')">
                <i class="fa fa-plus-square"></i>&nbsp;{{'Add Proposal' | translate}}
              </a>-->
            </p>
          </div>
          <div class="card-list" ng-repeat="member in members | limitTo:membersLimit">
            <div class="action-bar">
              <member-card user="member.user"></member-card>
              <div ng-if="userIsMember" class="action-button">
                <input id="menu04" type="checkbox" name="menu" ng-checked="member.checked" hidden/>
                <svg ng-click="member.checked = !member.checked" width="4px" height="16px" viewBox="0 0 4 16" version="1.1"
                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <title>{{'more' | translate}}</title>
                  <defs></defs>
                  <g id="Icon/Light/More-Vert" transform="translate(-10.000000, -4.000000)">
                    <g id="more">
                      <path d="M12,8 C13.1,8 14,7.1 14,6 C14,4.9 13.1,4 12,4 C10.9,4 10,4.9 10,6 C10,7.1 10.9,8 12,8 L12,8 Z M12,10 C10.9,10 10,10.9 10,12 C10,13.1 10.9,14 12,14 C13.1,14 14,13.1 14,12 C14,10.9 13.1,10 12,10 L12,10 Z M12,16 C10.9,16 10,16.9 10,18 C10,19.1 10.9,20 12,20 C13.1,20 14,19.1 14,18 C14,16.9 13.1,16 12,16 L12,16 Z"></path>
                    </g>
                  </g>
                </svg>
                <ul class="action-menu" ng-class="{shrinked: !member.checked}">
                  <li><a>{{'Message this user' | translate}}</a></li>
                  <li><a>{{'Remove this user' | translate}}</a></li>
                </ul>
              </div>
            </div>
            <p ng-if="!members || members.length === 0" class="card">{{'no.members.message' | translate}}</p>
          </div>
        </section>
      </section>
    </div>

    <!-- Working Group Ideas and Proposals -->
    <section class="proposals_and_ideas">
      <!--Working Group Ideas and Proposals Buttons-->
      <!--TODO: ADD button to joing working group if the user who is visiting is not a member-->
      <div class="campaign__filters">
        <h2 class="heading--header no-padding col-xs-12 col-lg-9 col-md-9 col-sm-8">{{'Proposals' | translate}}</h2>
        <a class="primary__button right proposals__add_new"
           ng-if="user != null && newProposalsEnabled"
           ng-click="openModal('proposalFormModal')">
          <i class="fa fa-plus-square"></i>&nbsp;{{'Add Proposal' | translate}}
        </a>

        <!--<a class="primary__button right proposals__add_new col-xs-12 col-lg-3 col-md-3 col-sm-4"-->
           <!--ng-if="newProposalsEnabled && !displayJoinWorkingGroup"-->
           <!--ng-click="openModal('proposalFormModal')">-->
          <!--<i class="fa fa-plus-square"></i>&nbsp;&nbsp;&nbsp;&nbsp;{{'Add Proposal' | translate}}-->
        <!--</a>-->
        <!--<a class="primary__button right join__working_group"-->
           <!--ng-if="newProposalsEnabled && displayJoinWorkingGroup && !newIdeasEnabled">-->
          <!--<i class="fa fa-users"></i>&nbsp;{{'Join a Working Group to create proposals' | translate}}-->
        <!--</a>-->
      </div>
      <proposals-ideas-searchbox search-handler="doSearch(filters)" load-themes="loadThemes(query)" campaign-contribution-types="{{ campaignConfigs['appcivist.campaign.contribution-types'] }}"
        generated-filters="filters" dry-run="true"></proposals-ideas-searchbox>
      
      
      <div class="campaign_cards" ng-class="{'show-ideas': commentsSectionExpanded || ideasSectionExpanded}">
        <section class="list--proposals">
          <header class="proposals__header" style="padding-top: 1em; padding-bottom:1em; padding-left: 1.5em; padding-right: 1.5em;">
            <!--<h2 class="heading&#45;&#45;header">{{'Proposals' | translate}}</h2>-->
            <!--<a class="proposals__add_new" ng-if="user != null && newProposalsEnabled" ng-click="openModal('proposalFormModal')"><i class="fa fa-plus-square"></i>&nbsp;{{'Add New' | translate}}</a>-->
            <a ng-if="!ideasSectionExpanded && contributionTypeIsSupported ('IDEA')" ng-click="toggleIdeasSection()"
              class="proposals__show_ideas" style="float: right; margin-right: 5px;" href=""><i class="fa fa-lightbulb-o"></i>&nbsp;{{'Show Ideas' | translate}}</a>&nbsp;&nbsp;&nbsp;
            <a class="hidden-md hidden-sm hidden-xs" ng-if="!commentsSectionExpanded && showComments" ng-click="toggleCommentsSection()"
              style="float: right; margin-right: 5px;" href=""><i class="fa fa-comments-o"></i>&nbsp;{{'Show Comments' | translate }}</a>&nbsp;&nbsp;&nbsp;
            <a ng-if="!insightsSectionExpanded" ng-click="toggleInsightsSection()" class="proposals__show_ideas"
              href=""><i class="fa fa-bar-chart"></i>&nbsp;{{'Show Insights' | translate }}</a>&nbsp;&nbsp;&nbsp;
            <a ng-if="insightsSectionExpanded" ng-click="toggleHideInsightsSection()" class="proposals__show_ideas"
              href=""><i class="fa fa-bar-chart"></i>{{'Hide Insights'|translate}}</a>&nbsp;&nbsp;
            <a ng-if="insightsSectionExpanded" class="proposals__show_ideas" href=""><i class="fa fa-file"></i> &nbsp;{{'Proposals' | translate}}: {{ insights.proposalsCount}}</a>
            <a ng-if="insightsSectionExpanded" class="proposals__show_ideas" href=""><i class="fa fa-lightbulb-o"></i> &nbsp;{{'Ideas' | translate}}: {{ insights.ideasCount}}</a>
            <a ng-if="insightsSectionExpanded" class="proposals__show_ideas" href=""><i class="fa fa-comment"></i> &nbsp;{{'Comments' | translate}}: {{ insights.proposalCommentsCount}}</a>
          </header>
          <div data-eq-pts="small: 768, medium: 1024, large: 1500" ng-iff="showPagination">
            <pagination-widget
              page-size="pageSize"
              space="spaceID"
              resource="contribution"
              type="type"
              is-anonymous="isAnonymous"
              is-coordinator="isCoordinator"
              filters="filters"
              is-topic-group="isTopicGroup"
              campaign="campaign"
              components="components"></pagination-widget>
            <p ng-if="!proposals || proposals.length === 0" class="card">{{'no.proposal.message' | translate}}</p>
          </div>
        </section>

        <!-- Ideas section -->
        <section class="list--ideas" ng-class="{hide: !ideasSectionExpanded}" ng-if="contributionTypeIsSupported ('IDEA')">
          <header class="ideas__header" style="padding-left: 30px;">
            <h2 class="heading--header">{{ 'Ideas' | translate }}</h2>
            <a class="ideas__see_all" ng-href="#/v2/space/{{spaceID}}/contributions?type=idea&from={{fromURL}}"><i class="fa fa-arrows-alt"></i>&nbsp;{{'See All' | translate}}</a>
            <a class="ideas__add_new" ng-if="user != null && newIdeasEnabled"><i class="fa fa-plus-square"></i>&nbsp;{{'Add New' | translate}}</a>
            <a ng-if="ideasSectionExpanded" ng-click="toggleHideIdeasSection()"><i class="fa fa-lightbulb-o"></i>&nbsp;{{ 'Hide Ideas' | translate }}</a>
          </header>
          <div class="list__cards container__ideas" data-eq-pts="small: 768, medium: 1024, large: 1500">
            <contribution-card ng-repeat="idea in ideas track by $index" class="card__idea col-lg-12 col-md-12 col-sm-12 col-xs-12"
                                contribution="idea"
                                campaign="campaign"
                                is-anonymous="isAnonymous"
                                show-voting-buttons="false"
                                is-coordinator="isCoordinator"
                                is-topic-group="isTopicGroup"
                                components="components"></contribution-card>
            <p ng-if="!ideas || ideas.length === 0" class="card" style="margin-left: 30px;">{{'no.idea.message' | translate}}</p>
          </div>
        </section>

        <!-- Comments section -->
        <section class="list--ideas" ng-class="{hide: !commentsSectionExpanded}">
          <header class="comments__header" style="padding-left: 30px;">
            <h2 class="heading--header">{{ 'Comments' | translate}}</h2>
            <a ng-if="commentsSectionExpanded" ng-click="toggleHideCommentsSection()" class="comments__show_ideas"
              href=""><i class="fa fa-comments-o"></i>{{'Hide Comments'|translate}}</a>&nbsp;&nbsp;
          </header>
          <div class="list__cards container__comments" data-eq-pts="small: 768, medium: 1024, large: 1500">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs custom-ul" style="padding-top: 0px; padding-bottom: 0px;">
              <li role="presentation" class="custom-li" ng-class="{'active': (activeTab === 'Members')}" ng-if="userIsMember"><a class="custom-a" href="" ng-click="changeActiveTab(1)" role="tab" data-toggle="tab">{{ 'Members' | translate }} ({{membersCommentCounter.value}})</a></li>
              <li role="presentation" class="custom-li" ng-class="{'active': (activeTab === 'Public')}"><a class="custom-a" href="" ng-click="changeActiveTab(2)" role="tab" data-toggle="tab">{{ 'Public' | translate }} ({{publicCommentCounter.value}})</a></li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content">
              <div class="tab-pane" ng-class="{'active': activeTab === 'Members'}" ng-if="userIsMember && activeTab === 'Members'">
                <discussion-panel style="padding-left: 0px !important;" class="col-md-12" ng-if="userIsMember" space-id="spaceID"
                  endpoint-id="spaceID" endpoint="group" is-anonymous="isAnonymous"></discussion-panel>
              </div>
              <div class="tab-pane" ng-class="{'active': activeTab === 'Public'}" ng-if="activeTab === 'Public'">
                <discussion-panel style="padding-left: 0px !important;" ng-if="isAnonymous" class="col-md-12" space-id="wg.frsUUID"
                  endpoint-id="wg.uuid" endpoint="group" public-board="true" is-anonymous="isAnonymous"></discussion-panel>
                <discussion-panel style="padding-left: 0px !important;" ng-if="!isAnonymous" class="col-md-12" space-id="wg.forumResourceSpaceId"
                  endpoint-id="wg.groupId" endpoint="group" public-board="true" is-anonymous="isAnonymous"></discussion-panel>
              </div>
            </div>
          </div>
        </section>
    </div>

    <!-- Nav tabs -->
    <ul class="hidden-lg nav nav-tabs custom-ul" style="padding-top: 0px; padding-bottom: 0px;">
      <li role="presentation" class="custom-li" ng-class="{'active': (activeTab === 'Members')}" ng-if="userIsMember"><a class="custom-a" href="" ng-click="changeActiveTab(1)" role="tab" data-toggle="tab">{{ 'Members Conversations' | translate }} ({{membersCommentCounter.value}})</a></li>
      <li role="presentation" class="custom-li" ng-class="{'active': (activeTab === 'Public')}"><a class="custom-a" href="" ng-click="changeActiveTab(2)" role="tab" data-toggle="tab">{{ 'Public Conversations' | translate }} ({{publicCommentCounter.value}})</a></li>
    </ul>

    <!-- Tab panes -->
    <div class="hidden-lg tab-content">
      <div class="tab-pane" ng-class="{'active': activeTab === 'Members'}" ng-if="userIsMember && activeTab === 'Members'">
        <discussion-panel class="col-md-12" ng-if="userIsMember" space-id="spaceID" endpoint-id="spaceID" endpoint="group"
          is-anonymous="isAnonymous"></discussion-panel>
      </div>
      <div class="tab-pane" ng-class="{'active': activeTab === 'Public'}" ng-if="activeTab === 'Public'">
        <discussion-panel ng-if="isAnonymous" class="col-md-12" space-id="wg.frsUUID" endpoint-id="wg.uuid" endpoint="group"
          public-board="true" is-anonymous="isAnonymous"></discussion-panel>
        <discussion-panel ng-if="!isAnonymous" class="col-md-12" space-id="wg.forumResourceSpaceId" endpoint-id="wg.groupId"
          endpoint="group" public-board="true" is-anonymous="isAnonymous"></discussion-panel>
      </div>
    </div>-
  </article>

  <script id="proposalFormModal" type="text/ng-template">
    <contribution-proposal-form
      group="wg"
      campaign="campaign"
      configs="campaignConfigs['appcivist.campaign.contribution.hidden-fields']"
      type="PROPOSAL"
      on-success="redirectToProposal(contribution)"
      on-import-success="closeModal('proposalFormModal')"
      user="user"></contribution-proposal-form>
  </script>

  <modal open-if="modals.proposalFormModal" close="closeModal('proposalFormModal')" template-id="proposalFormModal"></modal>
</main>
